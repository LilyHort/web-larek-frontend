# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Описание проекта
Проект интернет-магазина, разработанного с использованием паттерна проектирования MVP.

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Базовые компоненты

### Класс EventEmitter:
Класс EventEmitter обеспечивает работу событий. Его функции: возможность установить и снять слушателей событий, вызвать слушателей при возникновении события.

Конструктор:
`constructor()` - cоздает новый экземпляр класса EventEmitter.

Методы:
  - `on` - устанавливает обработчик для события.
  - `off` - удаляет обработчик для события.
  - `emit` - инициирует событие с переданными данными.
  - `onAll` - устанавливает обработчик для всех событий.
  - `offAll` - удаляет все обработчики событий.
  - `trigger` - создает триггер, который генерирует событие при вызове.

### Класс API:
Класс API обеспечивает базовые методы для работы с сервером. Его функции: возможность установить и снять слушателей событий, вызвать слушателей при возникновении события.

Конструктор:
`constructor(baseUrl: string, options: RequestInit = {})` - cоздает новый экземпляр класса API с указанным базовым URL и опциями запроса.

Методы:
  - `get` - выполняет GET запрос на сервер.
  - `post` - выполняет POST запрос на сервер.

### Класс Model<T>:
Абстрактный класс Model используется для представления модели данных, которые используются в приложении.

Конструктор:
`constructor(data: Partial<T>, events: IEvents)` - cоздает новый экземпляр класса Model с заданными данными и объект для управления событиями.

Методы:
  - `emitChanges` - cообщает всем подписчикам об изменениях в модели.

### Component<T>:
Абстрактный класс Component используется для создания UI компонентов.

Конструктор:
  `constructor(container: HTMLElement)` - принимает HTML элемент с которым будет происходить взаимодействие.

Методы:
  - `toggleClass` - переключает класс для элемента.
  - `setText` - устанавливает текст элемента.
  - `setImage` - устанавливает изображение элемента.
  - `setDisabled` - изменяет статус блокировки элемента.
  - `setHidden` - скрывает элемент.
  - `setVisible` - отоброжает элемент.
  - `render` - генерирует компонент.

## Общие компоненты

### Form:
Класс Form наследуется от `Component<IFormState>`. Служит для отображения форм, валидации и сабмита.

Конструктор:
`constructor(protected container: HTMLFormElement, protected events: IEvents)` - принимает элемент формы и объект для управления событиями.

Методы:
  - `set valid` - устанавливает доступность кнопки сабмита.
  - `set errors` - устанавливает ошибки формы.

Свойства:
  - `_submit` - кнопка отправки формы.
  - `_errors` - элемент отображения ошибок формы.

### Modal
Класс Modal выполняет функцию отображения модального окна и данных в нем. Наследуется от Component<IModalData>. 

Конструктор:
`constructor(container: HTMLElement, protected events: IEvents)` - принимает HTML элемент и объект для управления событиями.

Методы:
  - `open` - открывает модальное окно и создает событие открытия.
  - `close` - закрывает модальное окно и создает событие закрытия.

Свойства:
  - `_content: HTMLElement` - компонент для отображения в модальном окне.

## Компоненты модели данных (Model)

### AppState
Класс AppState описывает глобальное состояние приложения. Наследуется от `Model<IAppState>`. Использует конструктор родителя.

Методы:
  - `toggleOrderedProduct` - добавление/удаления товара из заказа.
  - `clearBasket` - очистка корзины и заказа.
  - `getTotal` - вычисление общей стоимости товаров в заказе.
  - `setCatalog` - установка каталога товаров и отправки события об изменении.
  - `setPreview` - установка предпросматриваемого товара и отправки события об изменении.
  - `setOrderField` - установка значения поля заказа и проверки наличия достаточных данных для оформления заказа.
  - `validateOrder` - валидация данных заказа и отправки события об изменении ошибок формы.

Свойства:
  - `basket: IProduct[]` - массив объектов товаров в корзине.
  - `catalog: IProduct[]` - массив объектов товаров в каталоге.
  - `order: IOrder`- заказ пользователя.
  - `preview: string | null` - идентификатор предпросматриваемого товара или null, если предпросмотр отключен.

## Компоненты приложения

### MainPageUI
Компонент выполняет функцию отображения главной страницы приложения, включая каталог товаров и кол-во товаров в корзине. Наследуется от `Component<IMainPageUI>`.

Конструктор:
`constructor(protected container: HTMLElement, protected events: IEvents)` - принимает HTML элемент и объект для управления событиями.

Методы:
  - `set catalog` - устанавливает элементы каталога.
  - `set counter` - устанавливает счетчик корзины.

Свойства:
  - `_catalog: HTMLElement` - каталог продуктов на странице.
  - `_counter: HTMLElement` - счетчик корзины.

### ProductCardUI
Компонент выполняет функцию отображения информации о продукте. Исползуется для отображения в каталоге, в карточке продукта и в списке товаров в корзине. Наследуется от `Component<IProduct>`.

Конструктор:
`constructor(protected blockName: string, container: HTMLElement, actions?: IProductCardActions)` - принимает название блока, HTML элемент, action функции при нажатии кнопки.

Свойства:
  - `_title: HTMLElement` - заголовок продукта.
  - `_image: HTMLImageElement` - изображение продукта.
  - `_description: HTMLElement` - описания продукта.
  - `_category: HTMLElement` - категории продукта.
  - `_price: HTMLElement` - цена продукта.
  - `_index: HTMLElement` - номер продукта в корзине.
  - `_button: HTMLButtonElement` - кнопка добавления в корзину или удаления из корзины.

### BasketUI
Компонент выполняет функцию отображения товаров в корзине (в модальном окне) и управления ими. Наследуется от `Component<IProductList>`.

Конструктор:
`constructor(container: HTMLElement, protected events: EventEmitter)` - принимает HTML элемент и объект для управления событиями.

Методы:
  - `set items` - устанавливает список товаров в корзине.
  - `set total` - устанавливает общую стоимость товаров в корзине.

Свойства:
  - `_items: HTMLElement` - список товаров в корзине.
  - `_total: HTMLElement` - стоимость товаров в корзине.
  - `_button: HTMLElement` - кнопка для оформления заказа.

### PaymentFormUI
Компонент выполняет функцию отображения формы оплаты и взаимодействию с ней. Наследуется от `Form<IPaymentForm>`.

Конструктор:
`constructor(container: HTMLElement, protected events: EventEmitter)` - принимает HTML элемент и объект для управления событиями.

Методы:
  - `set payment` - устанавливает способ оплаты.
  - `set address` - устанавливает адрес доставки.

Свойства:
  - `_paymentOnline: HTMLElement` - кнопка оплаты онлайн.
  - `_paymentOffline: HTMLElement` - кнопка оплаты оффлай.
  - `_address: HTMLElement` - адрес доставки.

### ContactFormUI
Компонент выполняет функцию отображения формы с контактами и взаимодействию с ней. Наследуется от Form<IContactsForm>.

Конструктор:
`constructor(container: HTMLElement, protected events: EventEmitter)` - принимает HTML элемент и объект для управления событиями.

Методы:
  - `set email` - устанавливает email.
  - `set phone` - устанавливает номер телефона.

Свойства:
  - `_email: HTMLElement` - email.
  - `_phone: HTMLElement` - номер телефона.

### PurchaseResultUI
Компонент выполняет функцию отображения результата покупки. Наследуется от `Component<IPurchaseResultUI>`.

Конструктор:
`constructor(container: HTMLElement, actions: IPurchaseResultActions)` - принимает HTML элемент и объект для управления событиями.

Методы:
  - `set total` - устанавливает сумму списания.

Свойства:
  - `_closeButton: HTMLElement` - кнопка закрытия.
  - `_total: HTMLElement` - сумма списания.

## Ключевые типы данных
Описаны в src/types/index.ts

## Взаимодействие компонентов
Компоненты взаимодействуют между собой посредством обработки и генерации событий. Ниже описана логика основного взаимодействия компонентов.

Объект класса `API` получает данные с сервера. Объект класса `AppState` обрабатывает полученные данные и кладет в каталог и генерирует событие `catalog:changed`. Объект класса `MainPageUI` получает событие и генерит страницу с каталогом из объектов класса `ProductCardUI`.
Все модальные окна генерируются с помощью объекта класса `Modal`. При клике на карточку генерируется событие `card:select`, по нему определяется какая карточка была выбрана и показывается её модальное окно.
При нажатие на кнопку "В корзину", генерируется событие `card:add`. По нему с помощью объекта класса `AppState`, товар добавляется в корзину.
При клике на иконку корзины генеируется событие `basket:open`. По нему происходит открытие модального окна корзины. Из объекта класса `AppState` объект класса `BasketUI` генерирует список товаров из объектов класса `ProductCardUI`. При клике на иконку удаления в корзине генерируется событие `card:delete`. По нему происходит изменение корзины в моделе `AppState` и изменяется счетчик корзины в 
`MainPageUI` и список товаров в `ProductCardUI`. При нажатии на кнопку "Оформить" генирируется событие `basket:order`. По нему с помощью объекта класса `PaymentFormUI` генерируется новое содержимое модального окна. При клике на кнопку способа оплаты генируется событие `payment:change`. По нему `AppState` сохраняет в моделе выбранный способ оплаты. При изменении адреса в форме генерируется событие `order:change`, по нему `AppState` выполняет валидацию и сохраняет в модель, а также генериует событие `formErrors:change`. По нему меняется состояние кнопки формы в `PaymentFormUI`.
При нажатие на кнопку "Далее" генерируется событие `order:submit`. По нему объектом класса `ContactFormUI` генерируется новое содержимое модального окна. Аналогично происходит отслеживание ошибок инпутов. При нажатии на кнопку "Оплатить" генерируется событие `contacts:submit`. По данному событию с помощью `API` происходит отпарвка данных на сервер. При положительном ответе от сервера происходит генерация нового содержимого модального окна объектом класса `PurchaseResultUI`.

### События

#### Карточка товара
 - `card:select` - событие нажатия на карточку товара в каталоге.
 - `card:add` - событие добавление товара в корзину.
 - `card:delete` - событие удаление товара из корзины.

#### Корзина
 - `basket:order` - событие нажатия на кнопку оформления заказа в корзине.
 - `basket:open` - событие нажатия на корзину заказа.

#### Модальное окно
 - `modal:open` - событие открытия модального окна.
 - `modal:close` - событие закрытия модального окна.

#### Приложение
 - `catalog:changed` - событие обновления каталога

#### Форма
 - `payment:change` - событие изменения способа оплаты.
 - `order:change` - событие изменения инпута с адресом.
 - `formErrors:change` - событие вызывает проверку формы.
 - `order:submit` - событие перехода к форме с контактными данными.
 - `contacts:submit` - событие окончания оформления заказа.
